name: Deploy CDK Stack and Trigger Schema Deployment

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy-core:
    uses: ./.github/workflows/deployCDK.yml
    with:
      stack-name: CoreStack

  deploy-auth:
    uses: ./.github/workflows/deployCDK.yml
    with:
      stack-name: AuthStack

  deploy-cluster:
    needs: deploy-core
    uses: ./.github/workflows/deployCDK.yml
    with:
      stack-name: ClusterStack

  deploy-database:
    needs: deploy-core
    uses: ./.github/workflows/deployCDK.yml
    with:
      stack-name: DatabaseStack

  deploy-app:
    needs: [deploy-cluster, deploy-database, deploy-auth]
    uses: ./.github/workflows/deployCDK.yml
    with:
      stack-name: AppStack
